<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--[if lt IE 9]>
    <script src="https://cdn.jsdelivr.cn/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
    <script src="https://cdn.jsdelivr.cn/npm/respond.js@1.4.2/dest/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" href="./bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="./css/PJDetial.css">
    <!-- <script src="/vue/vue.js"></script> -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <title>Project Detial Showcase</title>
    <link rel="icon" href="./images/uoa-logo.jpg" id="icon">  </link>
    <script src="./js/loginstate.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@8"></script>
</head>
<body>
<div id="backtop">
    <a href="#top"><img src="./images/rocket.svg" alt="backtop"></a>
</div>
<header>
    <section id="top" class="top-nav">
        <div class="left-menu col-md-8 ">
            <img src="./images/uoa-logo.jpg" alt="logo">

            <a href="./Home.html">Home</a>
            <a href="javascript:;">About us</a>
            <a href="./Projects.html"><button class="btn">Project</button></a>
            <a href="./login.html" id="login">Log in</a>
            <a href="./space.html" id="space">My Space</a>


        </div>
        <div class="search-wrap">
            <div>
                <input type="text" placeholder="Search Projects">
                <img src="./images/Search.svg" alt="Search">
            </div>
            <a href="javascript:;" id="signout"><button class="btn" onclick="signout()">Sign Out</button></a>
        </div>
    </section>
</header>
<main>
    <section class="pjinfo">
        <div class="like" v-if="like">
            <a href="javascript:;" @click="likePJ"><img src="./images/heart_remove.svg" alt="unlike_icon"><span><p>{{pj_likes}}</p></span></a>
        </div>
        <div class="like" v-if="unlike">
            <a href="javascript:;" @click="unlikePJ"><img src="./images/red-heart-icon.svg" alt="like_icon"><span><p>{{pj_likes}}</p></span></a>
        </div>
        <div class="pjname-container">
            <h1 id="pjname">{{pj_name}}</h1>
            <div class="pjdetial-container">
                <!-- <span id="pjlangu">{{pj_Tech}}</span> -->
                <span id="pjupdate">{{pj_date}}</span>
                <!-- <span id="pjviewnum">{{pj_views}} Views</span> -->
                <span id="pjlikenum">{{pj_likes}} Likes</span>
                <span id="pjcommentnum">{{pj_comnums}} Comments</span>
            </div>
            <span id="pjlangu">{{pj_Tech}}</span>
        </div>
        <div class="owneronly">
            <div id="editPj">
                <!-- <button>Edit Project</button> -->
            </div>
            <div id="invite">
                <!-- <input type="button" value="Save" /> -->
            </div>
        </div>
        
        <div class="pjteam-container">
            <div class="pjteaminfo">
                <div class="teamicon">
                    <div>
                        <a v-bind:href="pj_ownerSpace">
                            <img id="ownericon" src="./images/uoa-logo.jpg" alt="">
                        </a>
                        <a v-bind:href="pj_ownerSpace" id="teamname">
                            {{pj_tName}}
                        </a>
                    </div>
                    
                    <div id="tm">

                    </div>
                </div>
                <!-- <div class="teamname-container">

                </div> -->

            </div>
        </div>
        <hr>
        <div class="pjtext">
            {{pj_Tagline}}
        </div>
        <hr>
        <div class="pjtext" id="pjintro">

        </div>

        
    </section>

    <script>
        function getUrlParam(name) {

            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");

            var r = window.location.search.substr(1).match(reg);

            if (r != null) return unescape(r[2]); return null;

        }

        function cookie(cname){

            var name = cname + "=";

            var ca = document.cookie.split(';');

            for(var i=0; i<ca.length; i++) {

                var c = ca[i].trim();

                if (c.indexOf(name)==0) { return c.substring(name.length,c.length); }

            }

            return "";

        }


    </script>

    <script>
        var state = cookie("Auth");
        let vm = Vue.createApp({
            data(){
                return{
                    pj_name:"Project Nmae",
                    pj_Tagline:"2022 University Surveys - it’s not too late to have your say (and be entered in the prize draw)! ",
                    pj_Tech:"java",
                    pj_date:"2022/10/06",
                    pj_likes:50,
                    pj_comnums:10,
                    pj_tName:"Team Name",
                    pj_intro:"The 2022 Learning and Teaching Survey and the 2022 Research on Academic Integrity in New Zealand (RAINZ) Survey will be closing in the next few days, so check your student email for an invitation message and survey link. Your feedback is very important – the survey results are used to make changes and improvements that benefit you, such as adding captions to lecture recordings. For further information view the Learning & Teaching SurveyLinks to an external site. or RAINZ SurveyLinks to an external site. webpages Participation in these surveys is completely voluntary and does not affect any of your grades – but if you complete your survey by 10 October, you will be in the prize draw to win 1 of 60 $100 Prezzy cards. ",
                    pj_ownerSpace:"./space.html",
                    like: true,
                    unlike: false,
                    pj_teammate:"",
                    pj_award:0
                }
            },
            methods:{
                getName(uuid){
                    axios.get('user/getuser/'+uuid)
                        .then(function (response) {
                            vm.pj_tName = response.data.username;
                            axios.post("./project/getTeammateByPID?pid=" + getUrlParam("id"))
                              .then(function (res) {
                                document.getElementById("tm").innerHTML = "";
                                  try{
                                      let teammateHTML = "";
                                      let objs = res.data;
                                      for (let z = 0;z<objs.length;z++){
                                          teammateHTML+="<a href='./space.html?id="+ objs[z].id +"' title='"+objs[z].username+"'><img src='./user/getimg/" + objs[z].id + "' alt='"+objs[z].username+"'></a>";
                                      }
                                      document.getElementById("tm").innerHTML = teammateHTML;
                                  }catch (err){
                                      let obj = res.data;
                                      document.getElementById("tm").innerHTML ="<a href='./space.html?id="+obj.id+"' title='"+obj.username+"'><img src='./user/getimg/" + obj.id + "' alt='"+obj.username+"'></a>";
                                  }
                                })
                                .catch(function (error) {
                                    console.log(error);
                                });
                        })
                        .catch(function (error) {
                            console.log(error);
                        });
                },
                likePJ(){
                    if(state != "" && state != null){
                        let pjId = getUrlParam("id");
                        vm.like = !this.like;
                        vm.unlike = !this.unlike;
                        axios.post('project/like?pid='+pjId)
                            .then(function (response) {
                                // console.log(response);
                                if(response.data != "repeated like"){
                                    vm.pj_likes++;
                                }
                            })
                            .catch(function (error) {
                                console.log(error);
                            });
                    }else{
                        Swal.fire({
                        title: 'Like this project?',
                        text: "You need to be logged to like.",
                        type: 'info',
                        showCancelButton: true,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'Okay, gogogo!'
                        }).then((result) => {
                        if (result.value) {
                            window.location.href = "./login.html";
                        }
                        })
                    }

                },
                unlikePJ(){
                    vm.unlike = !this.unlike;
                    vm.like = !this.like;
                    let pjId = getUrlParam("id");
                    axios.post('project/unlike?pid='+pjId)
                        .then(function (response) {
                            // console.log(response);
                            vm.pj_likes--;
                        })
                        .catch(function (error) {
                            console.log(error);
                        });
                },
                getLike(){
                    let pjId = getUrlParam("id");
                    axios.get('project/getProjectLikeByID?pid='+pjId)
                        .then(function (response) {
                            vm.pj_likes= response.data;
                        })
                        .catch(function (error) {
                            console.log(error);
                        });
                },
                likeState(){
                    let pjId = getUrlParam("id");
                    axios.get('project/getlikestatus?pid='+pjId)
                        .then(function (response) {
                            var state= response.data;
                            if(state == "cannot like!"){
                                vm.like = false;
                                vm.unlike = true;
                            }
                        })
                        .catch(function (error) {
                            console.log(error);
                        });
                },
                getSkills(){
                    let pjId = getUrlParam("id");
                    axios.get('project/GetProjectSkills?pid='+pjId)
                        .then(function (response) {
                            vm.pj_Tech= response.data.substr(1,response.data.length-2);
                        })
                        .catch(function (error) {
                            console.log(error);
                        });
                }

            },
            mounted(){
                let pjId = getUrlParam("id");
                if(pjId==null){

                }else{
                    axios.get('project/getProjectPageByPid?pid='+pjId)
                        .then(function (response) {
                            let pjinfo = response.data;
                            vm.pj_award = pjinfo.award;
                            vm.pj_name= pjinfo.pname;
                            vm.pj_Tagline= pjinfo.tagline;
                            // vm.pj_Tech= pjinfo.technologies;
                            vm.pj_date= pjinfo.updatetime;
                            document.getElementById('pjintro').innerHTML = pjinfo.introduction;
                            vm.getName(pjinfo.owner);
                            vm.pj_ownerSpace= "./space.html?id="+ pjinfo.owner;
                            document.getElementById("ownericon").src = "./user/getimg/"+pjinfo.owner;
                        if(state!= ""){                       
                            axios.get('user/getown')
                                .then(function (response) {
                                    user_id = response.data.id;
                                    if(user_id == pjinfo.owner || response.data.authority == "admin"){
                                        document.getElementById("editPj").innerHTML = '<a style="float:right" href="./PJEdit.html?pid='+ pjId +'">Edit Project</a>';
                                    }
                                    if(user_id == pjinfo.owner){
                                        axios.get("./project/getInviteLink/" + getUrlParam("id"))
                                            .then(function (res) {
                                                document.getElementById("invite").innerHTML = "<p>Invite Link <input type='text' value='"+res.data+"' readonly> <button  href=\"javascript:void(0)\" onclick=\"generateNewInviteCode()\" class='glyphicon glyphicon-refresh'></button></p>";
                                            })
                                            .catch(function (error) {
                                                console.log(error);
                                        });
                                        axios.post("./project/getTeammateByPID?pid=" + getUrlParam("id"))
                                            .then(function (res) {
                                                document.getElementById("tm").innerHTML = "";
                                                try{
                                                    let teammateHTML = "";
                                                    let objs = res.data;
                                                    for (let z = 0;z<objs.length;z++){
                                                        teammateHTML+="<div style=\"position: relative\"><a href='./space.html?id="+ objs[z].id +"' title='"+objs[z].username+"'><img src='./user/getimg/" + objs[z].id + "' alt='"+objs[z].username+"'></a><a href='javascript:void(0)' onclick='removeTeammate(\"" + objs[z].id + "\")'><img src=\"data:image/png;base64,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\" style=\"position: absolute; top: 4px; right: 40px; height:20px; width: 20px;\"/></a></div>";
                                                    }
                                                    document.getElementById("tm").innerHTML = teammateHTML;
                                                }catch (err){
                                                    let obj = res.data;
                                                    document.getElementById("tm").innerHTML ="<div style=\"position: relative\"><a href='./space.html?id="+obj.id+"' title='"+obj.username+"'><img src='./user/getimg/" + obj.id + "' alt='"+obj.username+"'></a><a href='javascript:void(0)' onclick='removeTeammate(\"" + objs.id + "\")'><img src=\"data:image/png;base64,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\" style=\"position: absolute; top: 4px; right: 40px; height:20px; width: 20px;\"/></a></div>";
                                                }
                                            })
                                            .catch(function (error) {
                                                console.log(error);
                                            });
                                    }else{
                                        axios.post("./project/getTeammateByPID?pid=" + getUrlParam("id"))
                                            .then(function (res) {
                                                document.getElementById("tm").innerHTML = "";
                                                try{
                                                    let teammateHTML = "";
                                                    let objs = res.data;
                                                    for (let z = 0;z<objs.length;z++){
                                                        teammateHTML+="<div style=\"position: relative\"><a href='./space.html?id="+ objs[z].id +"' title='"+objs[z].username+"'><img src='./user/getimg/" + objs[z].id + "' alt='"+objs[z].username+"'></a></div>";
                                                    }
                                                    document.getElementById("tm").innerHTML = teammateHTML;
                                                }catch (err){
                                                    let obj = res.data;
                                                    document.getElementById("tm").innerHTML ="<div style=\"position: relative\"><a href='./space.html?id="+obj.id+"' title='"+obj.username+"'><img src='./user/getimg/" + obj.id + "' alt='"+obj.username+"'></a></div>";
                                                }
                                            })
                                            .catch(function (error) {
                                                console.log(error);
                                            });
                                    }
                                })
                                .catch(function (error) {
                                    console.log(error);
                                });
                                // if(vm.pj_award>0){
                                //     cm.getAward();
                                // }
                        }})
                        .catch(function (error) {
                            console.log(error);
                        });


                }
                this.getLike();
                if(state!= ""){
                    this.likeState();
                }
                this.getSkills();
                

            }
        }).mount('.pjinfo')

    </script>
<script>
    function generateNewInviteCode() {
        axios.get("./project/generateNewInviteCode/" + getUrlParam("id"))
            .then(function (res) {
                axios.get("./project/getInviteLink/" + getUrlParam("id"))
                    .then(function (res) {
                        document.getElementById("invite").innerHTML = "<p>Invite Link <input type='text' value='"+res.data+"' readonly> <button  href=\"javascript:void(0)\" onclick=\"generateNewInviteCode()\" class='glyphicon glyphicon-refresh'></button></p>";
                    })
                    .catch(function (error) {
                        console.log(error);
                    });
            })
            .catch(function (error) {
                console.log(error);
            });
    }
    
    function removeTeammate(id) {
            Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                type: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, delete it!'
            }).then((result) => {
                if (result.value) {
                    axios.post("./project/removeTeammate/",
                        "pid="+getUrlParam("id")+"&uid="+id)
                        .then(function (res) {
                            if (res.data == "success"){
                                Swal.fire({
                                    title: 'Deleted!',
                                    text: "Your \"teammate\" has been removed!",
                                    type: 'success',
                                    showCancelButton: false,
                                    confirmButtonColor: '#3085d6',
                                    confirmButtonText: 'Finally!'
                                    }).then((result) => {
                                        location.reload();
                                    })
                                
                            }
                            else {
                                Swal.fire({
                                    type: 'error',
                                    title: 'Oops...',
                                    text: 'Something went wrong!',
                                    footer: res.data
                                })
                            }
                        })
                        .catch(function (error) {
                            console.log(error);
                        });
                }
            })
        }
</script>
    <section class="pjcomments">
        <section id="award">
            <div class="commentnum" id="pjawardnum">{{pj_awardnums}} Awards</div>
            <hr id="pjawardnumhr">
            <div class="commentsend" id="addaward">
                <div class="usericon"><img v-bind:src="uimg" alt=""></div>
                <textarea type="text" placeholder="Add award comment" id="pj-award-text" v-model="pj_award"> </textarea>
                <button type="submit" id="pj-award-submit" @click="addAward">Add Award</button>
            </div>
            <hr id="addawardhr">
            <div id="awardget">
    
            </div>
    
        </section>
    
        <section id="comment">
    
            <div class="commentnum" id="pjcommentnum">{{pj_comnums}} Comments</div>
            <hr>
            <div class="commentsend">
                <div class="usericon"><img v-bind:src="uimg" alt=""></div>
                <textarea type="text" placeholder="Say Hi to the World!" id="pj-comment-text" v-model="pj_comment"> </textarea>
                <button type="submit" id="pj-comment-submit" @click="postComment">Post Comment</button>
            </div>
            <hr>
            <div id="commentget">
                <!--  -->
                <div class="commentdiv">
                    <div class="usericon"><a href="#"><img src="./images/uoa-logo.jpg" alt=""></a></div>
                    <div class="commentarea">
                        <a href="#" class="name"><h4>username</h4></a>
                        <p>Chicken you are too beautiful</p>
                        <span>
                                <p class="commentTime">2022/02/20</p>
                                <a href="#" id="del">Delete</a>
                            </span>
    
                    </div>
                </div>
                <hr>
                <!--  -->
    
            </div>
    
        </section>
    </section>
    
    <script>
        var state = cookie("Auth");
        let cm = Vue.createApp({
            data(){
                return{
                    pj_comment:"",
                    pj_Id:"",
                    pj_comnums:0,
                    uimg:"./images/uoa-logo.jpg",
                    pj_awardnums:0,
                    pj_award:""
                }
            },
            methods:{
                delComment(){
                    var cid = event.target.id;
                    let pjId = getUrlParam("id");
                    Swal.fire({
                        title: 'Are you sure?',
                        text: "You won't be able to revert this!",
                        type: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'Yes, delete it!'
                        }).then((result) => {
                        if (result.value) {
                            axios.post('project/removeComment',"pid="+pjId+"&cid="+cid)
                            .then(function(response){
                                if(response.data == "delete success" || response.data == "delete success by admin"){
                                    Swal.fire({
                                    title: 'Deleted!',
                                    text: "Comment has been deleted!",
                                    type: 'success',
                                    showCancelButton: false,
                                    confirmButtonColor: '#3085d6',
                                    confirmButtonText: 'Okay!'
                                    }).then((result) => {
                                        cm.getComments();
                                    }) 
                                }else{
                                    Swal.fire({
                                    type: 'error',
                                    title: 'Oops...',
                                    text: 'Something went wrong!',
                                    footer: response.data
                                })
                                }
                            })
                            .catch(function(error){
                                console.log(error);
                            });
                            
                        }
                        })
                },
                delAward(){
                    var uid = event.target.id;
                    Swal.fire({
                        title: 'Are you sure?',
                        text: "You won't be able to revert this!",
                        type: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'Yes, delete it!'
                        }).then((result) => {
                        if (result.value) {
                            axios.post("./project/DeleteAward?pid=" + getUrlParam("id")+"&uid="+uid)
                            .then(function(response){
                                if(response.data == "delete success" || response.data == "Delete success"){
                                    Swal.fire({
                                    title: 'Deleted!',
                                    text: "Award has been deleted!",
                                    type: 'success',
                                    showCancelButton: false,
                                    confirmButtonColor: '#3085d6',
                                    confirmButtonText: 'Okay!'
                                    }).then((result) => {
                                        cm.getAward();
                                    }) 
                                }else{
                                    Swal.fire({
                                    type: 'error',
                                    title: 'Oops...',
                                    text: 'Something went wrong!',
                                    footer: response.data
                                })
                                }
                            })
                            .catch(function(error){
                                console.log(error);
                            });
                            
                        }
                        })  
                },
                async getComments(){
                    let page = 1;
                    let pjId = getUrlParam("id");
                    let user_auth = "";
                    let user_id = "";
                    if(state!=""){
                        await axios.get('user/getown')
                        .then(async function (response) {
                            user_auth=response.data.authority;
                            user_id = response.data.id;
                            cm.uimg = "./user/getimg/"+user_id;
                        })
                        .catch(function (error) {
                            console.log(error);
                        });
                    }
                    

                    await axios.get('project/getComment/'+page+"?&pid="+pjId)
                        .then(async function (response) {
                            vm.pj_comnums= response.data.length;
                            cm.pj_comnums= response.data.length;
                            var data = response.data;
                            document.getElementById("commentget").innerHTML="";
                            for(let i=0; i<response.data.length; i++){
                                var comment = data[i].comment;
                                var cTime = data[i].time;
                                var cId = data[i].cid;
                                var uuid = data[i].uid;
                                var uname = data[i].uname;
                                //
                                var div_comment = document.createElement("div");
                                div_comment.className="commentdiv";
                                var div_usericon = document.createElement("div");
                                div_usericon.className = "usericon";
                                var a_user = document.createElement("a");
                                a_user.href = "./space.html?id="+ uuid;
                                //userIcon
                                var img_icon = document.createElement("img");
                                var imgsrc = "./images/uoa-logo.jpg";
                                if(uuid != null && uuid != ""){
                                    var imgsrc = "./user/getimg/"+uuid;
                                }
                                img_icon.src = imgsrc;
                                a_user.appendChild(img_icon);
                                //userIcon
                                div_usericon.appendChild(a_user);
                                var div_carea = document.createElement("div");
                                div_carea.className = "commentarea";
                                var a_username = document.createElement("a");
                                a_username.href = "./space.html?id="+ uuid;
                                a_username.className = "name";
                                var hfour = document.createElement("h4");
                                hfour.innerText = uname;
                                a_username.appendChild(hfour);
                                div_carea.appendChild(a_username);
                                var p_comment = document.createElement("p");
                                p_comment.innerText = comment;
                                div_carea.appendChild(p_comment);
                                var span = document.createElement("span");
                                var p_time = document.createElement("p");
                                p_time.innerText = cTime;
                                p_time.className = "commentTime";
                                span.appendChild(p_time);
                                //Delete
                                if(user_auth == "admin" || user_id == uuid){
                                    var a_del = document.createElement("a");
                                    a_del.href = "javascript:;";
                                    a_del.className = "del";
                                    a_del.innerText = "Delete";
                                    a_del.id=cId;
                                    a_del.onclick= cm.delComment;

                                    // var del = '<a href="javascript:;" @click="delComment('+cId+')" id="del">Delete</a>';
                                    // a_del.innerHTML =del;
                                    span.appendChild(a_del);

                                }
                                //Delete
                                div_carea.append(span);
                                div_comment.append(div_usericon);
                                div_comment.append(div_carea);
                                document.getElementById("commentget").appendChild(div_comment);
                                var hr = document.createElement("hr");
                                document.getElementById("commentget").appendChild(hr);
                            }

                        })
                        .catch(function (error) {
                            console.log(error);
                        });

                },
                postComment(){
                    let Id = getUrlParam("id");
                    cm.pj_Id = Id;
                    if(state != "" && state != null){
                        axios.post('project/writeComment',
                            "pid="+cm.pj_Id+"&comment="+cm.pj_comment)
                            .then(function (response) {
                                cm.pj_comment="";
                                cm.getComments();

                            })
                            .catch(function (error) {
                                console.log(error);
                            });

                    }else{
                        Swal.fire({
                        title: 'Wanna post comment?',
                        text: "You need to be logged in to post a comment.",
                        type: 'info',
                        showCancelButton: true,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'Okay, gogogo!'
                        }).then((result) => {
                        if (result.value) {
                            window.location.href = "./login.html";
                        }
                        })
                        // window.location.href = "./login.html";
                    }
                },
                async getAward(){
                    let user_auth = "";
                    let uname = "";
                    if(state!=""){
                        await axios.get('user/getown')
                        .then(async function (response) {
                            user_auth=response.data.authority;
                            uname = response.data.username;
                        })
                        .catch(function (error) {
                                console.log(error);
                        });
                    }else{
                        document.getElementById("addaward").style.display = "none";
                        document.getElementById("addawardhr").style.display = "none";
                    }
                    await axios.get("./project/GetAwardCommentByID?pid=" + getUrlParam("id"))
                        .then(async function (res) {
                            var data = res.data;
                            cm.pj_awardnums = data.length;
                            if(cm.pj_awardnums>=0){
                                if(cm.pj_awardnums == 0){
                                    document.getElementById("pjawardnum").style.display = "none";
                                    document.getElementById("pjawardnumhr").style.display = "none";
                                }
                                document.getElementById("awardget").innerHTML = "";
                                for(var i =0; i<cm.pj_awardnums; i++){
                                    var adiv = document.createElement("div");
                                    var acover = document.createElement("img");
                                    acover.src = "./images/award.svg";
                                    acover.className = "awardcover";
                                    adiv.className = "awarddiv";
                                    var tspace = document.createElement("a");
                                    tspace.href = "./space.html?id="+ data[i].uid;
                                    var ticon = document.createElement("img");
                                    ticon.src = "./user/getimg/"+ data[i].uid;
                                    var ah3 = document.createElement("h3");
                                    var ah4 = document.createElement("h4");
                                    var hr = document.createElement("hr");
                                    ah3.innerText = data[i].teachername + ":";
                                    ah4.innerText = data[i].teachercomment;
                                    if(data[i].teachername == uname || user_auth == "admin"){
                                        document.getElementById("addaward").style.display = "none";
                                        document.getElementById("addawardhr").style.display = "none";
                                        var a_del = document.createElement("a");
                                        a_del.href = "javascript:;";
                                        a_del.className = "del";
                                        a_del.innerText = "Delete";
                                        a_del.onclick= cm.delAward;
                                        a_del.id = data[i].uid;
                                        tspace.appendChild(ticon);
                                        tspace.appendChild(ah3);
                                        adiv.appendChild(acover);
                                        adiv.appendChild(tspace);
                                        adiv.appendChild(hr);
                                        adiv.appendChild(ah4);
                                        adiv.appendChild(a_del);
                                        
                                    }else{
                                        adiv.appendChild(acover);
                                        tspace.appendChild(ticon);
                                        tspace.appendChild(ah3);
                                        adiv.appendChild(tspace);
                                        adiv.appendChild(hr);
                                        adiv.appendChild(ah4);
                                        
                                    }
                                    document.getElementById("awardget").appendChild(adiv);
                                    
                                }

                                document.getElementById("award").style.display = "block";
                                
                            }
                            
                        })
                        .catch(function (error) {
                            console.log(error);
                        });
                    if(user_auth!="teacher"){
                        document.getElementById("addaward").style.display = "none";
                        document.getElementById("addawardhr").style.display = "none";
                    }else{
                        document.getElementById("addaward").style.display = "flex";
                        document.getElementById("addawardhr").style.display = "block";
                        document.getElementById("award").style.display = "block";
                        document.getElementById("pjawardnum").style.display = "block";
                        document.getElementById("pjawardnumhr").style.display = "block";
                    }

                    
                },
                addAward(){
                    axios.post("./project/addAward?pid=" + getUrlParam("id")+"&comment="+cm.pj_award)
                    .then(function(res){
                        cm.getAward();
                        cm.pj_award = "";
                    })
                    .catch(function(err){
                        console.log(err);
                    })
                },
                
                // getUserimg(uid){
                //     // var uid = event.target.id;
                //     var imgsrc = "./images/uoa-logo.jpg";
                //     axios.get('user/getimg/'+uid)
                //         .then(function (response) {
                //             if(response.data != null && response.data != ""){
                //                 imgsrc=response.data;
                //             }

                //         })
                //         .catch(function (error) {
                //             console.log(error);
                //         });
                //     console.log(imgsrc);
                //     return imgsrc;
                // }
            },
            mounted(){
                this.getComments();
                this.getAward();

            }
        }).mount('.pjcomments')

    </script>



</main>
<footer>
    <section id="bottomBody" class=".container">
        <nav class="col-md-6">
            <ul>
                <h4>Team19</h4>
                <li><a href="#">About</a></li>
                <li><a href="#">Contact</a></li>
                <li><a href="#">Help</a></li>
            </ul>
        </nav>
        <nav class="col-md-6">
            <ul>
                <h4>Profile</h4>
                <li><a href="./PJDetail.html">My projects</a></li>
                <li><a href="./space.html">My homepage</a></li>
                <li><a href="./setting.html">Settings</a></li>
            </ul>
        </nav>
    </section>
    <hr>
    <section id="legalBar"><p>&copy; 2022 Team19.&nbspAll rights reserved. </p></section>
</footer>
</body>
</html>